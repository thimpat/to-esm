<span style="font-size:40px;">ğŸ’¡</span>

## Create a Hybrid Library with to.esm supporting the browser !heading


<br><br>




### 1- Use .cjs extensions instead of .js

```
ğŸ“project  
â””â”€â”€â”€ ğŸ“ index.cjs                â¬… ğŸš©
â””â”€â”€â”€ ğŸ“ package.json
â””â”€â”€â”€ ğŸ“example
â”‚    â”‚
â”‚    â””â”€â”€â”€ğŸ“code
â”‚        â””â”€â”€â”€   ğŸ“ library.cjs   â‡½ ğŸš©
â”‚               ...
â”‚
â””â”€â”€â”€ ğŸ“ node_modules
â”‚    â””â”€â”€ ...
         
```


<br/>



### 2- Run to-esm against the entry point

```shell
$> to-esm --entrypoint index.cjs --output ./generated --update-all --target browser --bundle index.min.cjs
```

> ğŸš«
_If you are not targeting the browser, ignore --target and --bundle options_
> ```shell
> $> to-esm --entrypoint index.cjs --update-all
> ```

> ğŸš«
_It is possible that my bundling implementation fails (I haven't seen it fail yet). It's five hours of work, so it's
> likely
> not perfect. You can use an external bundler like Rollup, for instance, to bundle your final work_
> ```shell
> $> rollup index.cjs --file index.min.js --format iife
> ```
> 
---



###### Click on the arrow to expand or collapse
<details><summary><strong>â³ Before...</strong></summary>

ğŸ“ ./package.json â†´
```json
{
  "name": "my-project",
  "main": "./index.cjs",
  "scripts": {
    "build": "to-esm --entrypoint index.cjs"
  },
  "devDependencies": {
    "to-esm": "file:.."
  }
}
```

ğŸ“ ./index.cjs â†´
```javascript
const hi = require("./example/code/library.cjs");
hi();
```

ğŸ“ ././example/code/library.cjs â†´
```javascript
function hi()
{
    console.log(`I wanted to say hi!`)
}

module.exports = hi;
```

</details>

---

<details><summary><strong>âŒ› After...</strong></summary>

ğŸ“ **./package.json** â†´ _(Updated because of the --update-all option)_
```json
{
  "name": "my-project",
  "main": "./index.cjs",
  "scripts": {
    "build": "to-esm --entrypoint index.cjs"
  },
  "devDependencies": {
    "to-esm": "file:.."
  },
  "module": "./index.mjs",
  "type": "module",
  "exports": {
    ".": {
      "require": "./index.cjs",   // â¬… 
      "import": "./index.mjs"     // â¬… 
    }
  }
}

```


ğŸ“ ./index.mjs â†´
```javascript
/**
 * DO NOT EDIT THIS FILE DIRECTLY.
 * This file is generated following the conversion of
 * [./index.cjs]{@link ./index.cjs}
 *
 **/
import hi  from "./example/code/library.mjs";
hi();
```

ğŸ“ ././example/code/library.mjs â†´
```javascript
/**
 * DO NOT EDIT THIS FILE DIRECTLY.
 * This file is generated following the conversion of
 * [./example/code/library.cjs]{@link ./example/code/library.cjs}
 *
 **/
function hi()
{
    console.log(`I wanted to say hi!`)
}

export default hi;
```

ğŸ“ **./dist/index.min.js** â†´ (Generated because of the --bundle option)
```javascript
const c={"95c93":{}};c["95c93"].default=function(){console.log("I wanted to say hi!")};{c.bbc7e={};let b=c["95c93"].default;b()}
```


</details>

---

<br/>



### 3- Your code is generated.

```
ğŸ“project  
â””â”€â”€â”€ ğŸ“ index.cjs                
â””â”€â”€â”€ ğŸ“ package.json
â””â”€â”€â”€ ğŸ“generated                 
â”‚    â”‚
â”‚    â””â”€â”€â”€ ğŸ“ index.mjs          â¬… ğŸš©
â”‚    â”‚     
â”‚    â””â”€â”€â”€ ğŸ“ ...
â”‚
â””â”€â”€â”€ ğŸ“ dist         
â”‚    â””â”€â”€ index.min.js           â¬… ğŸš©
         
```

##### Insert the standard JavaScript version

```html
...
<body>
<script type="module" src="generated/index.mjs"></script>      â¬… ğŸš©    
</body>
...
```

##### or the bundled version into your HTML

```html
...
<body>
<script type="module" src="dist/index.min.mjs"></script>      â¬… ğŸš©    
</body>
...
```